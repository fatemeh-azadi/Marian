\hypertarget{classmarian_1_1DecoderS2S}{}\section{marian\+:\+:Decoder\+S2S Class Reference}
\label{classmarian_1_1DecoderS2S}\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}


{\ttfamily \#include $<$s2s.\+h$>$}



Inheritance diagram for marian\+:\+:Decoder\+S2S\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=208pt]{d4/d5e/classmarian_1_1DecoderS2S__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for marian\+:\+:Decoder\+S2S\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{d5/d66/classmarian_1_1DecoderS2S__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$class... Args$>$ }\\\hyperlink{classmarian_1_1DecoderS2S_a2b85c8e7d064a0baa1a489ca208584d1}{Decoder\+S2S} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1Config}{Config} $>$ options, Args...\+args)
\item 
virtual \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ \hyperlink{classmarian_1_1DecoderS2S_a7a96b3617137d832395542405c903b1e}{start\+State} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1EncoderState}{Encoder\+State} $>$ enc\+State)
\item 
virtual \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ \hyperlink{classmarian_1_1DecoderS2S_a786a6f2e325d86a8335cc5fc25170518}{step} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1ExpressionGraph}{Expression\+Graph} $>$ graph, \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ state)
\item 
virtual const std\+::vector$<$ \hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} $>$ \hyperlink{classmarian_1_1DecoderS2S_a4da86da8904d9f2fb1eedf44709d225d}{get\+Alignments} ()
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ rnn\+::\+R\+NN $>$ \hyperlink{classmarian_1_1DecoderS2S_adad1c24cac6a5c5f2a679df18f3c0f58}{construct\+Decoder\+R\+NN} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1ExpressionGraph}{Expression\+Graph} $>$ graph, \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ state)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ rnn\+::\+R\+NN $>$ \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\+\_\+}
\item 
\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} \hyperlink{classmarian_1_1DecoderS2S_afdcd53fd8c14663b24af51651e8e3e6e}{tied\+Output\+Weights\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 174 of file s2s.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!Decoder\+S2S@{Decoder\+S2S}}
\index{Decoder\+S2S@{Decoder\+S2S}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{Decoder\+S2\+S(\+Ptr$<$ Config $>$ options, Args...\+args)}{DecoderS2S(Ptr< Config > options, Args...args)}}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class... Args$>$ marian\+::\+Decoder\+S2\+S\+::\+Decoder\+S2S (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Config} $>$}]{options, }
\item[{Args...}]{args}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{classmarian_1_1DecoderS2S_a2b85c8e7d064a0baa1a489ca208584d1}{}\label{classmarian_1_1DecoderS2S_a2b85c8e7d064a0baa1a489ca208584d1}


Definition at line 245 of file s2s.\+h.


\begin{DoxyCode}
246       : \hyperlink{classmarian_1_1DecoderBase_a85b857fc8ff57bbd1608efaa4cf5765e}{DecoderBase}(options, args...) \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!construct\+Decoder\+R\+NN@{construct\+Decoder\+R\+NN}}
\index{construct\+Decoder\+R\+NN@{construct\+Decoder\+R\+NN}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{construct\+Decoder\+R\+N\+N(\+Ptr$<$ Expression\+Graph $>$ graph, Ptr$<$ Decoder\+State $>$ state)}{constructDecoderRNN(Ptr< ExpressionGraph > graph, Ptr< DecoderState > state)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Ptr}$<$rnn\+::\+R\+NN$>$ marian\+::\+Decoder\+S2\+S\+::construct\+Decoder\+R\+NN (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Expression\+Graph} $>$}]{graph, }
\item[{{\bf Ptr}$<$ {\bf Decoder\+State} $>$}]{state}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}\hypertarget{classmarian_1_1DecoderS2S_adad1c24cac6a5c5f2a679df18f3c0f58}{}\label{classmarian_1_1DecoderS2S_adad1c24cac6a5c5f2a679df18f3c0f58}


Definition at line 179 of file s2s.\+h.


\begin{DoxyCode}
180                                                            \{
181   \textcolor{keywordtype}{float} dropoutRnn = \hyperlink{classmarian_1_1DecoderBase_a808975d515f60a53096f6794c3dc61d4}{inference\_} ? 0 : opt<float>(\textcolor{stringliteral}{"dropout-rnn"});
182   \textcolor{keyword}{auto} \hyperlink{namespacemarian_1_1rnn_aff1b115e415945b445f8d4a2068ec3e8}{rnn} = \hyperlink{namespacemarian_1_1rnn_aff1b115e415945b445f8d4a2068ec3e8}{rnn::rnn}(graph)
183              (\textcolor{stringliteral}{"type"}, opt<std::string>(\textcolor{stringliteral}{"dec-cell"}))
184              (\textcolor{stringliteral}{"dimInput"}, opt<int>(\textcolor{stringliteral}{"dim-emb"}))
185              (\textcolor{stringliteral}{"dimState"}, opt<int>(\textcolor{stringliteral}{"dim-rnn"}))
186              (\textcolor{stringliteral}{"dropout"}, dropoutRnn)
187              (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"}))
188              (\textcolor{stringliteral}{"skip"}, opt<bool>(\textcolor{stringliteral}{"skip"}));
189 
190   \textcolor{keywordtype}{size\_t} decoderLayers = opt<size\_t>(\textcolor{stringliteral}{"dec-depth"});
191   \textcolor{keywordtype}{size\_t} decoderBaseDepth = opt<size\_t>(\textcolor{stringliteral}{"dec-cell-base-depth"});
192   \textcolor{keywordtype}{size\_t} decoderHighDepth = opt<size\_t>(\textcolor{stringliteral}{"dec-cell-high-depth"});
193 
194   \textcolor{comment}{// setting up conditional (transitional) cell}
195   \textcolor{keyword}{auto} baseCell = \hyperlink{namespacemarian_1_1rnn_a55385034d5ad19187245bb2b564cb7eb}{rnn::stacked\_cell}(graph);
196   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 1; i <= decoderBaseDepth; ++i) \{
197     \textcolor{keyword}{auto} paramPrefix = \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_cell"} + std::to\_string(i);
198     baseCell.push\_back(\hyperlink{namespacemarian_1_1rnn_af723e51535e0b11de5b28fe19627a3fb}{rnn::cell}(graph)
199                        (\textcolor{stringliteral}{"prefix"}, paramPrefix)
200                        (\textcolor{stringliteral}{"final"}, i > 1));
201     \textcolor{keywordflow}{if}(i == 1)
202       baseCell.push\_back(\hyperlink{namespacemarian_1_1rnn_a57316dc4c756edb2a8dfabea7e50d92b}{rnn::attention}(graph)
203                          (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_})
204                          .set\_state(state->getEncoderState()));
205   \}
206   \textcolor{comment}{// Add cell to RNN (first layer)}
207   rnn.push\_back(baseCell);
208 
209   \textcolor{comment}{// Add more cells to RNN (stacked RNN)}
210   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 2; i <= decoderLayers; ++i) \{
211     \textcolor{comment}{// deep transition}
212     \textcolor{keyword}{auto} highCell = \hyperlink{namespacemarian_1_1rnn_a55385034d5ad19187245bb2b564cb7eb}{rnn::stacked\_cell}(graph);
213 
214     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j = 1; j <= decoderHighDepth; j++) \{
215       \textcolor{keyword}{auto} paramPrefix = \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_l"} + std::to\_string(i) + \textcolor{stringliteral}{"\_cell"} + std::to\_string(j);
216       highCell.push\_back(\hyperlink{namespacemarian_1_1rnn_af723e51535e0b11de5b28fe19627a3fb}{rnn::cell}(graph)
217                          (\textcolor{stringliteral}{"prefix"}, paramPrefix));
218     \}
219 
220     \textcolor{comment}{// @TODO:}
221     \textcolor{comment}{// dec-high-context : none repeat conditional conditional-repeat}
222     \textcolor{comment}{// conditional and conditional-repeat require dec-cell-high-depth > 1}
223 
224     \textcolor{comment}{// Repeat attention output as input for each layer}
225     \textcolor{comment}{//if(opt<std::string>("dec-high-context") == "repeat") \{}
226     \textcolor{comment}{//  highCell.add\_input(}
227     \textcolor{comment}{//    [](Ptr<rnn::RNN> rnn) \{}
228     \textcolor{comment}{//      return rnn->at(0)->as<rnn::StackedCell>()}
229     \textcolor{comment}{//                ->at(1)->as<rnn::Attention>()}
230     \textcolor{comment}{//                ->getContext();}
231     \textcolor{comment}{//    \}}
232     \textcolor{comment}{//  );}
233     \textcolor{comment}{//  highCell("dimInputExtra", 2 * opt<int>("dim-rnn"));}
234     \textcolor{comment}{//\}}
235 
236     \textcolor{comment}{// Add cell to RNN (more layers)}
237     rnn.push\_back(highCell);
238   \}
239 
240   \textcolor{keywordflow}{return} rnn.construct();
241 \}
\end{DoxyCode}
\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!get\+Alignments@{get\+Alignments}}
\index{get\+Alignments@{get\+Alignments}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{get\+Alignments()}{getAlignments()}}]{\setlength{\rightskip}{0pt plus 5cm}virtual const std\+::vector$<${\bf Expr}$>$ marian\+::\+Decoder\+S2\+S\+::get\+Alignments (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1DecoderS2S_a4da86da8904d9f2fb1eedf44709d225d}{}\label{classmarian_1_1DecoderS2S_a4da86da8904d9f2fb1eedf44709d225d}


Reimplemented from \hyperlink{classmarian_1_1DecoderBase_af80f32ecf263ae43bbddd7401e57b472}{marian\+::\+Decoder\+Base}.



Definition at line 328 of file s2s.\+h.


\begin{DoxyCode}
328                                                 \{
329     \textcolor{keyword}{auto} att = \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_}->at(0)->as<rnn::StackedCell>()->at(1)->as<\hyperlink{namespacemarian_1_1rnn_ae9586d2236bd64dae0a644c58d9fc76e}{rnn::Attention}>();
330     \textcolor{keywordflow}{return} att->\hyperlink{classmarian_1_1rnn_1_1GlobalAttention_a7fab38ad7965922a7e8eb26f0d4906af}{getAlignments}();
331   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d4b/classmarian_1_1DecoderS2S_a4da86da8904d9f2fb1eedf44709d225d_cgraph}
\end{center}
\end{figure}


\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!start\+State@{start\+State}}
\index{start\+State@{start\+State}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{start\+State(\+Ptr$<$ Encoder\+State $>$ enc\+State)}{startState(Ptr< EncoderState > encState)}}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Ptr}$<${\bf Decoder\+State}$>$ marian\+::\+Decoder\+S2\+S\+::start\+State (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Encoder\+State} $>$}]{enc\+State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1DecoderS2S_a7a96b3617137d832395542405c903b1e}{}\label{classmarian_1_1DecoderS2S_a7a96b3617137d832395542405c903b1e}


Implements \hyperlink{classmarian_1_1DecoderBase_a26b37dc5cebf21cea9e1f8b5ef5c8040}{marian\+::\+Decoder\+Base}.



Definition at line 248 of file s2s.\+h.


\begin{DoxyCode}
248                                                                    \{
249     \textcolor{keyword}{using namespace }\hyperlink{namespacekeywords}{keywords};
250 
251     \textcolor{comment}{// average the source context weighted by the batch mask}
252     \textcolor{comment}{// this will remove padded zeros from the average}
253     \textcolor{keyword}{auto} meanContext = \hyperlink{namespacemarian_a8ccb9507a69a32ecd48410fd1557f209}{weighted\_average}(encState->getContext(),
254                                         encState->getMask(),
255                                         \hyperlink{namespacemarian_1_1keywords_ace9158eabbddaca833133f12da98b9d6}{axis} = 2);
256 
257     \textcolor{keyword}{auto} graph = meanContext->graph();
258 
259     \textcolor{comment}{// apply single layer network to mean to map into decoder space}
260     \textcolor{keyword}{auto} \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp} = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp::mlp}(graph)
261                .push\_back(\hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
262                           (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_state"})
263                           (\textcolor{stringliteral}{"dim"}, opt<int>(\textcolor{stringliteral}{"dim-rnn"}))
264                           (\textcolor{stringliteral}{"activation"}, \hyperlink{namespacemarian_1_1mlp_ac16d27a877d16d7394f2057aee439d72a5c0dbba3a6ee4ac0eb26cfee75ccb8b4}{mlp::act::tanh})
265                           (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"})));
266     \textcolor{keyword}{auto} start = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp}->apply(meanContext);
267 
268     \hyperlink{namespaceamunmt_a4fe2912e208820f8217fbcf229ebacf7}{rnn::States} startStates(opt<size\_t>(\textcolor{stringliteral}{"dec-depth"}), \{start, start\});
269     \textcolor{keywordflow}{return} New<DecoderState>(startStates, \textcolor{keyword}{nullptr}, encState);
270   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d4b/classmarian_1_1DecoderS2S_a7a96b3617137d832395542405c903b1e_cgraph}
\end{center}
\end{figure}


\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!step@{step}}
\index{step@{step}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{step(\+Ptr$<$ Expression\+Graph $>$ graph, Ptr$<$ Decoder\+State $>$ state)}{step(Ptr< ExpressionGraph > graph, Ptr< DecoderState > state)}}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Ptr}$<${\bf Decoder\+State}$>$ marian\+::\+Decoder\+S2\+S\+::step (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Expression\+Graph} $>$}]{graph, }
\item[{{\bf Ptr}$<$ {\bf Decoder\+State} $>$}]{state}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1DecoderS2S_a786a6f2e325d86a8335cc5fc25170518}{}\label{classmarian_1_1DecoderS2S_a786a6f2e325d86a8335cc5fc25170518}


Implements \hyperlink{classmarian_1_1DecoderBase_a7d4f658f7b33660948f5a960ba667a4b}{marian\+::\+Decoder\+Base}.



Definition at line 272 of file s2s.\+h.


\begin{DoxyCode}
273                                                           \{
274     \textcolor{keyword}{using namespace }\hyperlink{namespacekeywords}{keywords};
275 
276     \textcolor{keyword}{auto} embeddings = state->getTargetEmbeddings();
277 
278     \textcolor{comment}{// dropout target words}
279     \textcolor{keywordtype}{float} dropoutTrg = \hyperlink{classmarian_1_1DecoderBase_a808975d515f60a53096f6794c3dc61d4}{inference\_} ? 0 : opt<float>(\textcolor{stringliteral}{"dropout-trg"});
280     \textcolor{keywordflow}{if}(dropoutTrg) \{
281       \textcolor{keywordtype}{int} trgWords = embeddings->shape()[2];
282       \textcolor{keyword}{auto} trgWordDrop = graph->dropout(dropoutTrg, \{1, 1, trgWords\});
283       embeddings = \hyperlink{namespacemarian_a268400392f22176821c7c4a36733b178}{dropout}(embeddings, \hyperlink{namespacemarian_1_1keywords_a201bea6bea8108889b63081132cc3cd7}{mask} = trgWordDrop);
284     \}
285 
286     \textcolor{keywordflow}{if}(!\hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_})
287       \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_} = \hyperlink{classmarian_1_1DecoderS2S_adad1c24cac6a5c5f2a679df18f3c0f58}{constructDecoderRNN}(graph, state);
288 
289     \textcolor{comment}{// apply RNN to embeddings, initialized with encoder context mapped into}
290     \textcolor{comment}{// decoder space}
291     \textcolor{keyword}{auto} decoderContext = \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_}->transduce(embeddings, state->getStates());
292 
293     \textcolor{comment}{// retrieve the last state per layer. They are required during translation}
294     \textcolor{comment}{// in order to continue decoding for the next word}
295     \hyperlink{namespaceamunmt_a4fe2912e208820f8217fbcf229ebacf7}{rnn::States} decoderStates = \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_}->lastCellStates();
296 
297     \textcolor{comment}{// retrieve all the aligned contexts computed by the attention mechanism}
298     \textcolor{keyword}{auto} att = \hyperlink{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{rnn\_}->at(0)->as<rnn::StackedCell>()->at(1)->as<\hyperlink{namespacemarian_1_1rnn_ae9586d2236bd64dae0a644c58d9fc76e}{rnn::Attention}>();
299     \textcolor{keyword}{auto} alignedContext = att->\hyperlink{classmarian_1_1rnn_1_1GlobalAttention_ad518e4c82f56b8f95393dffa2df2288b}{getContext}();
300 
301     \textcolor{comment}{// construct deep output multi-layer network layer-wise}
302     \textcolor{keyword}{auto} layer1 = \hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
303                   (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_logit\_l1"})
304                   (\textcolor{stringliteral}{"dim"}, opt<int>(\textcolor{stringliteral}{"dim-emb"}))
305                   (\textcolor{stringliteral}{"activation"}, \hyperlink{namespacemarian_1_1mlp_ac16d27a877d16d7394f2057aee439d72a5c0dbba3a6ee4ac0eb26cfee75ccb8b4}{mlp::act::tanh})
306                   (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"}));
307 
308     \textcolor{keywordtype}{int} dimTrgVoc = opt<std::vector<int>>(\textcolor{stringliteral}{"dim-vocabs"}).back();
309 
310     \textcolor{keyword}{auto} layer2 = \hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
311                   (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_logit\_l2"})
312                   (\textcolor{stringliteral}{"dim"}, dimTrgVoc);
313     \textcolor{keywordflow}{if}(opt<bool>(\textcolor{stringliteral}{"tied-embeddings"}))
314       layer2.tie\_transposed(\textcolor{stringliteral}{"W"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_Wemb"});
315 
316     \textcolor{comment}{// assemble layers into MLP and apply to embeddings, decoder context and}
317     \textcolor{comment}{// aligned source context}
318     \textcolor{keyword}{auto} logits = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp::mlp}(graph)
319                   .push\_back(layer1)
320                   .push\_back(layer2)
321                   ->apply(embeddings, decoderContext, alignedContext);
322 
323     \textcolor{comment}{// return unormalized(!) probabilities}
324     \textcolor{keywordflow}{return} New<DecoderState>(decoderStates, logits, state->getEncoderState());
325   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d4b/classmarian_1_1DecoderS2S_a786a6f2e325d86a8335cc5fc25170518_cgraph}
\end{center}
\end{figure}




\subsection{Member Data Documentation}
\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!rnn\+\_\+@{rnn\+\_\+}}
\index{rnn\+\_\+@{rnn\+\_\+}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{rnn\+\_\+}{rnn_}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Ptr}$<$rnn\+::\+R\+NN$>$ marian\+::\+Decoder\+S2\+S\+::rnn\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}{}\label{classmarian_1_1DecoderS2S_aa4292be54117f5fc7bee31fac549a93c}


Definition at line 176 of file s2s.\+h.

\index{marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}!tied\+Output\+Weights\+\_\+@{tied\+Output\+Weights\+\_\+}}
\index{tied\+Output\+Weights\+\_\+@{tied\+Output\+Weights\+\_\+}!marian\+::\+Decoder\+S2S@{marian\+::\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{tied\+Output\+Weights\+\_\+}{tiedOutputWeights_}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Expr} marian\+::\+Decoder\+S2\+S\+::tied\+Output\+Weights\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1DecoderS2S_afdcd53fd8c14663b24af51651e8e3e6e}{}\label{classmarian_1_1DecoderS2S_afdcd53fd8c14663b24af51651e8e3e6e}


Definition at line 177 of file s2s.\+h.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{s2s_8h}{s2s.\+h}\end{DoxyCompactItemize}
