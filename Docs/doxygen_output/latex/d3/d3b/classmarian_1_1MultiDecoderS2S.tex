\hypertarget{classmarian_1_1MultiDecoderS2S}{}\section{marian\+:\+:Multi\+Decoder\+S2S Class Reference}
\label{classmarian_1_1MultiDecoderS2S}\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}


{\ttfamily \#include $<$multi\+\_\+s2s.\+h$>$}



Inheritance diagram for marian\+:\+:Multi\+Decoder\+S2S\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=208pt]{d8/d59/classmarian_1_1MultiDecoderS2S__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for marian\+:\+:Multi\+Decoder\+S2S\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{d0/ddf/classmarian_1_1MultiDecoderS2S__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$class... Args$>$ }\\\hyperlink{classmarian_1_1MultiDecoderS2S_a68eed32b91e7a057d3311669c15b91d2}{Multi\+Decoder\+S2S} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1Config}{Config} $>$ options, Args...\+args)
\item 
virtual \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ \hyperlink{classmarian_1_1MultiDecoderS2S_a3facd6e243c6fd8d656b49dedbba4948}{start\+State} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1EncoderState}{Encoder\+State} $>$ enc\+State)
\item 
virtual \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ \hyperlink{classmarian_1_1MultiDecoderS2S_a6f0421ce42840c6198f3d450b3d55bfb}{step} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1ExpressionGraph}{Expression\+Graph} $>$ graph, \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ state)
\item 
virtual const std\+::vector$<$ \hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} $>$ \hyperlink{classmarian_1_1MultiDecoderS2S_a9d82178076ee276d1f83ac4e040d959b}{get\+Alignments} ()
\end{DoxyCompactItemize}
\subsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ rnn\+::\+R\+NN $>$ \hyperlink{classmarian_1_1MultiDecoderS2S_a9f48a07e49a8b2608eadc93138cde75c}{construct\+Decoder\+R\+NN} (\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1ExpressionGraph}{Expression\+Graph} $>$ graph, \hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ \hyperlink{classmarian_1_1DecoderState}{Decoder\+State} $>$ state)
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\hyperlink{namespacemarian_ad1a373be43a00ef9ce35666145137b08}{Ptr}$<$ rnn\+::\+R\+NN $>$ \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\+\_\+}
\item 
\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} \hyperlink{classmarian_1_1MultiDecoderS2S_afbfb909daccdfdbcc46c0240221fbaa9}{tied\+Output\+Weights\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}


Definition at line 50 of file multi\+\_\+s2s.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!Multi\+Decoder\+S2S@{Multi\+Decoder\+S2S}}
\index{Multi\+Decoder\+S2S@{Multi\+Decoder\+S2S}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{Multi\+Decoder\+S2\+S(\+Ptr$<$ Config $>$ options, Args...\+args)}{MultiDecoderS2S(Ptr< Config > options, Args...args)}}]{\setlength{\rightskip}{0pt plus 5cm}template$<$class... Args$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::\+Multi\+Decoder\+S2S (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Config} $>$}]{options, }
\item[{Args...}]{args}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{classmarian_1_1MultiDecoderS2S_a68eed32b91e7a057d3311669c15b91d2}{}\label{classmarian_1_1MultiDecoderS2S_a68eed32b91e7a057d3311669c15b91d2}


Definition at line 112 of file multi\+\_\+s2s.\+h.


\begin{DoxyCode}
113       : \hyperlink{classmarian_1_1DecoderBase_a85b857fc8ff57bbd1608efaa4cf5765e}{DecoderBase}(options, args...) \{\}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!construct\+Decoder\+R\+NN@{construct\+Decoder\+R\+NN}}
\index{construct\+Decoder\+R\+NN@{construct\+Decoder\+R\+NN}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{construct\+Decoder\+R\+N\+N(\+Ptr$<$ Expression\+Graph $>$ graph, Ptr$<$ Decoder\+State $>$ state)}{constructDecoderRNN(Ptr< ExpressionGraph > graph, Ptr< DecoderState > state)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Ptr}$<$rnn\+::\+R\+NN$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::construct\+Decoder\+R\+NN (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Expression\+Graph} $>$}]{graph, }
\item[{{\bf Ptr}$<$ {\bf Decoder\+State} $>$}]{state}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [private]}}\hypertarget{classmarian_1_1MultiDecoderS2S_a9f48a07e49a8b2608eadc93138cde75c}{}\label{classmarian_1_1MultiDecoderS2S_a9f48a07e49a8b2608eadc93138cde75c}


Definition at line 55 of file multi\+\_\+s2s.\+h.


\begin{DoxyCode}
56                                                            \{
57   \textcolor{keywordtype}{float} dropoutRnn = \hyperlink{classmarian_1_1DecoderBase_a808975d515f60a53096f6794c3dc61d4}{inference\_} ? 0 : opt<float>(\textcolor{stringliteral}{"dropout-rnn"});
58   \textcolor{keyword}{auto} \hyperlink{namespacemarian_1_1rnn_aff1b115e415945b445f8d4a2068ec3e8}{rnn} = \hyperlink{namespacemarian_1_1rnn_aff1b115e415945b445f8d4a2068ec3e8}{rnn::rnn}(graph)
59              (\textcolor{stringliteral}{"type"}, opt<std::string>(\textcolor{stringliteral}{"dec-cell"}))
60              (\textcolor{stringliteral}{"dimInput"}, opt<int>(\textcolor{stringliteral}{"dim-emb"}))
61              (\textcolor{stringliteral}{"dimState"}, opt<int>(\textcolor{stringliteral}{"dim-rnn"}))
62              (\textcolor{stringliteral}{"dropout"}, dropoutRnn)
63              (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"}))
64              (\textcolor{stringliteral}{"skip"}, opt<bool>(\textcolor{stringliteral}{"skip"}));
65 
66   \textcolor{keywordtype}{size\_t} decoderLayers = opt<size\_t>(\textcolor{stringliteral}{"dec-depth"});
67   \textcolor{keywordtype}{size\_t} decoderBaseDepth = opt<size\_t>(\textcolor{stringliteral}{"dec-cell-base-depth"});
68   \textcolor{keywordtype}{size\_t} decoderHighDepth = opt<size\_t>(\textcolor{stringliteral}{"dec-cell-high-depth"});
69 
70   \textcolor{comment}{// setting up conditional (transitional) cell}
71   \textcolor{keyword}{auto} baseCell = \hyperlink{namespacemarian_1_1rnn_a55385034d5ad19187245bb2b564cb7eb}{rnn::stacked\_cell}(graph);
72   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 1; i <= decoderBaseDepth; ++i) \{
73     \textcolor{keyword}{auto} paramPrefix = \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_cell"} + std::to\_string(i);
74     baseCell.push\_back(\hyperlink{namespacemarian_1_1rnn_af723e51535e0b11de5b28fe19627a3fb}{rnn::cell}(graph)
75                        (\textcolor{stringliteral}{"prefix"}, paramPrefix)
76                        (\textcolor{stringliteral}{"final"}, i > 1));
77     \textcolor{keywordflow}{if}(i == 1) \{
78       \textcolor{keyword}{auto} mEncState = std::static\_pointer\_cast<EncoderStateMultiS2S>(
79         state->getEncoderState());
80 
81       baseCell.push\_back(\hyperlink{namespacemarian_1_1rnn_a57316dc4c756edb2a8dfabea7e50d92b}{rnn::attention}(graph)
82                          (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_att1"})
83                          .set\_state(mEncState->enc1));
84       baseCell.push\_back(\hyperlink{namespacemarian_1_1rnn_a57316dc4c756edb2a8dfabea7e50d92b}{rnn::attention}(graph)
85                          (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_att2"})
86                          .set\_state(mEncState->enc2));
87     \}
88   \}
89   \textcolor{comment}{// Add cell to RNN (first layer)}
90   rnn.push\_back(baseCell);
91 
92   \textcolor{comment}{// Add more cells to RNN (stacked RNN)}
93   \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 2; i <= decoderLayers; ++i) \{
94     \textcolor{comment}{// deep transition}
95     \textcolor{keyword}{auto} highCell = \hyperlink{namespacemarian_1_1rnn_a55385034d5ad19187245bb2b564cb7eb}{rnn::stacked\_cell}(graph);
96 
97     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} j = 1; j <= decoderHighDepth; j++) \{
98       \textcolor{keyword}{auto} paramPrefix = \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_l"} + std::to\_string(i) + \textcolor{stringliteral}{"\_cell"} + std::to\_string(j);
99       highCell.push\_back(\hyperlink{namespacemarian_1_1rnn_af723e51535e0b11de5b28fe19627a3fb}{rnn::cell}(graph)
100                          (\textcolor{stringliteral}{"prefix"}, paramPrefix));
101     \}
102 
103     \textcolor{comment}{// Add cell to RNN (more layers)}
104     rnn.push\_back(highCell);
105   \}
106 
107   \textcolor{keywordflow}{return} rnn.construct();
108 \}
\end{DoxyCode}
\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!get\+Alignments@{get\+Alignments}}
\index{get\+Alignments@{get\+Alignments}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{get\+Alignments()}{getAlignments()}}]{\setlength{\rightskip}{0pt plus 5cm}virtual const std\+::vector$<${\bf Expr}$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::get\+Alignments (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1MultiDecoderS2S_a9d82178076ee276d1f83ac4e040d959b}{}\label{classmarian_1_1MultiDecoderS2S_a9d82178076ee276d1f83ac4e040d959b}


Reimplemented from \hyperlink{classmarian_1_1DecoderBase_af80f32ecf263ae43bbddd7401e57b472}{marian\+::\+Decoder\+Base}.



Definition at line 204 of file multi\+\_\+s2s.\+h.


\begin{DoxyCode}
204                                                 \{
205     \textcolor{keyword}{auto} att = \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_}->at(0)->as<rnn::StackedCell>()->at(1)->as<\hyperlink{namespacemarian_1_1rnn_ae9586d2236bd64dae0a644c58d9fc76e}{rnn::Attention}>();
206     \textcolor{keywordflow}{return} att->\hyperlink{classmarian_1_1rnn_1_1GlobalAttention_a7fab38ad7965922a7e8eb26f0d4906af}{getAlignments}();
207   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d3b/classmarian_1_1MultiDecoderS2S_a9d82178076ee276d1f83ac4e040d959b_cgraph}
\end{center}
\end{figure}


\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!start\+State@{start\+State}}
\index{start\+State@{start\+State}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{start\+State(\+Ptr$<$ Encoder\+State $>$ enc\+State)}{startState(Ptr< EncoderState > encState)}}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Ptr}$<${\bf Decoder\+State}$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::start\+State (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Encoder\+State} $>$}]{enc\+State}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1MultiDecoderS2S_a3facd6e243c6fd8d656b49dedbba4948}{}\label{classmarian_1_1MultiDecoderS2S_a3facd6e243c6fd8d656b49dedbba4948}


Implements \hyperlink{classmarian_1_1DecoderBase_a26b37dc5cebf21cea9e1f8b5ef5c8040}{marian\+::\+Decoder\+Base}.



Definition at line 115 of file multi\+\_\+s2s.\+h.


\begin{DoxyCode}
115                                                                    \{
116     \textcolor{keyword}{using namespace }\hyperlink{namespacekeywords}{keywords};
117 
118     \textcolor{keyword}{auto} mEncState = std::static\_pointer\_cast<EncoderStateMultiS2S>(encState);
119 
120     \textcolor{keyword}{auto} meanContext1 = \hyperlink{namespacemarian_a8ccb9507a69a32ecd48410fd1557f209}{weighted\_average}(
121         mEncState->enc1->getContext(), mEncState->enc1->getMask(), \hyperlink{namespacemarian_1_1keywords_ace9158eabbddaca833133f12da98b9d6}{axis} = 2);
122 
123     \textcolor{keyword}{auto} meanContext2 = \hyperlink{namespacemarian_a8ccb9507a69a32ecd48410fd1557f209}{weighted\_average}(
124         mEncState->enc2->getContext(), mEncState->enc2->getMask(), \hyperlink{namespacemarian_1_1keywords_ace9158eabbddaca833133f12da98b9d6}{axis} = 2);
125 
126     \textcolor{keyword}{auto} graph = meanContext1->graph();
127 
128     \textcolor{comment}{// apply single layer network to mean to map into decoder space}
129     \textcolor{keyword}{auto} \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp} = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp::mlp}(graph)
130                .push\_back(\hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
131                           (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_state"})
132                           (\textcolor{stringliteral}{"dim"}, opt<int>(\textcolor{stringliteral}{"dim-rnn"}))
133                           (\textcolor{stringliteral}{"activation"}, \hyperlink{namespacemarian_1_1mlp_ac16d27a877d16d7394f2057aee439d72a5c0dbba3a6ee4ac0eb26cfee75ccb8b4}{mlp::act::tanh})
134                           (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"})));
135     \textcolor{keyword}{auto} start = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp}->apply(meanContext1, meanContext2);
136 
137     \hyperlink{namespaceamunmt_a4fe2912e208820f8217fbcf229ebacf7}{rnn::States} startStates(opt<size\_t>(\textcolor{stringliteral}{"dec-depth"}), \{start, start\});
138     \textcolor{keywordflow}{return} New<DecoderState>(startStates, \textcolor{keyword}{nullptr}, mEncState);
139   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d3b/classmarian_1_1MultiDecoderS2S_a3facd6e243c6fd8d656b49dedbba4948_cgraph}
\end{center}
\end{figure}


\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!step@{step}}
\index{step@{step}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{step(\+Ptr$<$ Expression\+Graph $>$ graph, Ptr$<$ Decoder\+State $>$ state)}{step(Ptr< ExpressionGraph > graph, Ptr< DecoderState > state)}}]{\setlength{\rightskip}{0pt plus 5cm}virtual {\bf Ptr}$<${\bf Decoder\+State}$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::step (
\begin{DoxyParamCaption}
\item[{{\bf Ptr}$<$ {\bf Expression\+Graph} $>$}]{graph, }
\item[{{\bf Ptr}$<$ {\bf Decoder\+State} $>$}]{state}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [virtual]}}\hypertarget{classmarian_1_1MultiDecoderS2S_a6f0421ce42840c6198f3d450b3d55bfb}{}\label{classmarian_1_1MultiDecoderS2S_a6f0421ce42840c6198f3d450b3d55bfb}


Implements \hyperlink{classmarian_1_1DecoderBase_a7d4f658f7b33660948f5a960ba667a4b}{marian\+::\+Decoder\+Base}.



Definition at line 141 of file multi\+\_\+s2s.\+h.


\begin{DoxyCode}
142                                                           \{
143     \textcolor{keyword}{using namespace }\hyperlink{namespacekeywords}{keywords};
144 
145     \textcolor{keyword}{auto} embeddings = state->getTargetEmbeddings();
146 
147     \textcolor{comment}{// dropout target words}
148     \textcolor{keywordtype}{float} dropoutTrg = \hyperlink{classmarian_1_1DecoderBase_a808975d515f60a53096f6794c3dc61d4}{inference\_} ? 0 : opt<float>(\textcolor{stringliteral}{"dropout-trg"});
149     \textcolor{keywordflow}{if}(dropoutTrg) \{
150       \textcolor{keywordtype}{int} trgWords = embeddings->shape()[2];
151       \textcolor{keyword}{auto} trgWordDrop = graph->dropout(dropoutTrg, \{1, 1, trgWords\});
152       embeddings = \hyperlink{namespacemarian_a268400392f22176821c7c4a36733b178}{dropout}(embeddings, \hyperlink{namespacemarian_1_1keywords_a201bea6bea8108889b63081132cc3cd7}{mask} = trgWordDrop);
153     \}
154 
155     \textcolor{keywordflow}{if}(!\hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_})
156       \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_} = \hyperlink{classmarian_1_1MultiDecoderS2S_a9f48a07e49a8b2608eadc93138cde75c}{constructDecoderRNN}(graph, state);
157 
158     \textcolor{comment}{// apply RNN to embeddings, initialized with encoder context mapped into}
159     \textcolor{comment}{// decoder space}
160     \textcolor{keyword}{auto} decoderContext = \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_}->transduce(embeddings, state->getStates());
161 
162     \textcolor{comment}{// retrieve the last state per layer. They are required during translation}
163     \textcolor{comment}{// in order to continue decoding for the next word}
164     \hyperlink{namespaceamunmt_a4fe2912e208820f8217fbcf229ebacf7}{rnn::States} decoderStates = \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_}->lastCellStates();
165 
166     \textcolor{comment}{// retrieve all the aligned contexts computed by the attention mechanism}
167     \textcolor{keyword}{auto} att1 = \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_}->at(0)->as<rnn::StackedCell>()->at(1)->as<
      \hyperlink{namespacemarian_1_1rnn_ae9586d2236bd64dae0a644c58d9fc76e}{rnn::Attention}>();
168     \textcolor{keyword}{auto} alignedContext1 = att1->\hyperlink{classmarian_1_1rnn_1_1GlobalAttention_ad518e4c82f56b8f95393dffa2df2288b}{getContext}();
169 
170     \textcolor{keyword}{auto} att2 = \hyperlink{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{rnn\_}->at(0)->as<rnn::StackedCell>()->at(2)->as<
      \hyperlink{namespacemarian_1_1rnn_ae9586d2236bd64dae0a644c58d9fc76e}{rnn::Attention}>();
171     \textcolor{keyword}{auto} alignedContext2 = att2->\hyperlink{classmarian_1_1rnn_1_1GlobalAttention_ad518e4c82f56b8f95393dffa2df2288b}{getContext}();
172 
173     \textcolor{keyword}{auto} alignedContext = \hyperlink{namespacemarian_a2791a2c8f79a938f5cb22ae613680675}{concatenate}(\{alignedContext1,
174                                        alignedContext2\},
175                                        \hyperlink{namespacemarian_1_1keywords_ace9158eabbddaca833133f12da98b9d6}{axis}=1);
176 
177     \textcolor{comment}{// construct deep output multi-layer network layer-wise}
178     \textcolor{keyword}{auto} layer1 = \hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
179                   (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_logit\_l1"})
180                   (\textcolor{stringliteral}{"dim"}, opt<int>(\textcolor{stringliteral}{"dim-emb"}))
181                   (\textcolor{stringliteral}{"activation"}, \hyperlink{namespacemarian_1_1mlp_ac16d27a877d16d7394f2057aee439d72a5c0dbba3a6ee4ac0eb26cfee75ccb8b4}{mlp::act::tanh})
182                   (\textcolor{stringliteral}{"layer-normalization"}, opt<bool>(\textcolor{stringliteral}{"layer-normalization"}));
183 
184     \textcolor{keywordtype}{int} dimTrgVoc = opt<std::vector<int>>(\textcolor{stringliteral}{"dim-vocabs"}).back();
185 
186     \textcolor{keyword}{auto} layer2 = \hyperlink{namespacemarian_1_1mlp_a8c25b1e343bf78e66cd9e33e607efeb5}{mlp::dense}(graph)
187                   (\textcolor{stringliteral}{"prefix"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_ff\_logit\_l2"})
188                   (\textcolor{stringliteral}{"dim"}, dimTrgVoc);
189     \textcolor{keywordflow}{if}(opt<bool>(\textcolor{stringliteral}{"tied-embeddings"}))
190       layer2.tie\_transposed(\textcolor{stringliteral}{"W"}, \hyperlink{classmarian_1_1DecoderBase_a043a90801b6bda9a45e309607136e947}{prefix\_} + \textcolor{stringliteral}{"\_Wemb"});
191 
192     \textcolor{comment}{// assemble layers into MLP and apply to embeddings, decoder context and}
193     \textcolor{comment}{// aligned source context}
194     \textcolor{keyword}{auto} logits = \hyperlink{namespacemarian_1_1mlp_a4d0fe240d31bdc33bcbdb5401de49e27}{mlp::mlp}(graph)
195                   .push\_back(layer1)
196                   .push\_back(layer2)
197                   ->apply(embeddings, decoderContext, alignedContext);
198 
199     \textcolor{comment}{// return unormalized(!) probabilities}
200     \textcolor{keywordflow}{return} New<DecoderState>(decoderStates, logits, state->getEncoderState());
201   \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/d3b/classmarian_1_1MultiDecoderS2S_a6f0421ce42840c6198f3d450b3d55bfb_cgraph}
\end{center}
\end{figure}




\subsection{Member Data Documentation}
\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!rnn\+\_\+@{rnn\+\_\+}}
\index{rnn\+\_\+@{rnn\+\_\+}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{rnn\+\_\+}{rnn_}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Ptr}$<$rnn\+::\+R\+NN$>$ marian\+::\+Multi\+Decoder\+S2\+S\+::rnn\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}{}\label{classmarian_1_1MultiDecoderS2S_aa17bae4e5a1cb917737c8d23511a5701}


Definition at line 52 of file multi\+\_\+s2s.\+h.

\index{marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}!tied\+Output\+Weights\+\_\+@{tied\+Output\+Weights\+\_\+}}
\index{tied\+Output\+Weights\+\_\+@{tied\+Output\+Weights\+\_\+}!marian\+::\+Multi\+Decoder\+S2S@{marian\+::\+Multi\+Decoder\+S2S}}
\subsubsection[{\texorpdfstring{tied\+Output\+Weights\+\_\+}{tiedOutputWeights_}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Expr} marian\+::\+Multi\+Decoder\+S2\+S\+::tied\+Output\+Weights\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1MultiDecoderS2S_afbfb909daccdfdbcc46c0240221fbaa9}{}\label{classmarian_1_1MultiDecoderS2S_afbfb909daccdfdbcc46c0240221fbaa9}


Definition at line 53 of file multi\+\_\+s2s.\+h.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{multi__s2s_8h}{multi\+\_\+s2s.\+h}\end{DoxyCompactItemize}
