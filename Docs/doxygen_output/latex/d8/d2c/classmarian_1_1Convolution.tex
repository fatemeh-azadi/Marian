\hypertarget{classmarian_1_1Convolution}{}\section{marian\+:\+:Convolution Class Reference}
\label{classmarian_1_1Convolution}\index{marian\+::\+Convolution@{marian\+::\+Convolution}}


{\ttfamily \#include $<$convolution.\+h$>$}



Collaboration diagram for marian\+:\+:Convolution\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=277pt]{db/dc7/classmarian_1_1Convolution__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmarian_1_1Convolution_a7ec673f9c5d0af080721411152f5f944}{Convolution} (const std\+::string \&name, int kernel\+Height=3, int kernel\+Width=3, int kernel\+Num=1, int depth=1)
\item 
\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} \hyperlink{classmarian_1_1Convolution_ac5755a44695ec454ca80d8f309a20e80}{operator()} (\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} x)
\item 
\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} \hyperlink{classmarian_1_1Convolution_a81e17c2e8691fb6bcb922343e797a23a}{operator()} (\hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} x, \hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} mask)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{classmarian_1_1Convolution_a10d9391dababa5ca35ada157ba4974ee}{depth\+\_\+}
\item 
int \hyperlink{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}{kernel\+Height\+\_\+}
\item 
int \hyperlink{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}{kernel\+Width\+\_\+}
\item 
int \hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernel\+Num\+\_\+}
\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ \hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} $>$ \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\+\_\+}
\item 
std\+::string \hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\+\_\+}
\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 9 of file convolution.\+h.



\subsection{Constructor \& Destructor Documentation}
\index{marian\+::\+Convolution@{marian\+::\+Convolution}!Convolution@{Convolution}}
\index{Convolution@{Convolution}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{Convolution(const std\+::string \&name, int kernel\+Height=3, int kernel\+Width=3, int kernel\+Num=1, int depth=1)}{Convolution(const std::string &name, int kernelHeight=3, int kernelWidth=3, int kernelNum=1, int depth=1)}}]{\setlength{\rightskip}{0pt plus 5cm}marian\+::\+Convolution\+::\+Convolution (
\begin{DoxyParamCaption}
\item[{const std\+::string \&}]{name, }
\item[{int}]{kernel\+Height = {\ttfamily 3}, }
\item[{int}]{kernel\+Width = {\ttfamily 3}, }
\item[{int}]{kernel\+Num = {\ttfamily 1}, }
\item[{int}]{depth = {\ttfamily 1}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{classmarian_1_1Convolution_a7ec673f9c5d0af080721411152f5f944}{}\label{classmarian_1_1Convolution_a7ec673f9c5d0af080721411152f5f944}


Definition at line 11 of file convolution.\+h.


\begin{DoxyCode}
17       : \hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\_}(name),
18         \hyperlink{classmarian_1_1Convolution_a10d9391dababa5ca35ada157ba4974ee}{depth\_}(depth),
19         \hyperlink{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}{kernelHeight\_}(kernelHeight),
20         \hyperlink{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}{kernelWidth\_}(kernelWidth),
21         \hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernelNum\_}(kernelNum) \{
22     \}
\end{DoxyCode}


\subsection{Member Function Documentation}
\index{marian\+::\+Convolution@{marian\+::\+Convolution}!operator()@{operator()}}
\index{operator()@{operator()}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{operator()(\+Expr x)}{operator()(Expr x)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Expr} marian\+::\+Convolution\+::operator() (
\begin{DoxyParamCaption}
\item[{{\bf Expr}}]{x}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{classmarian_1_1Convolution_ac5755a44695ec454ca80d8f309a20e80}{}\label{classmarian_1_1Convolution_ac5755a44695ec454ca80d8f309a20e80}


Definition at line 24 of file convolution.\+h.


\begin{DoxyCode}
24                             \{
25       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_}.clear();
26       \textcolor{keyword}{auto} graph = x->graph();
27 
28       \textcolor{keywordtype}{int} layerIn = x->shape()[1];
29 
30       \textcolor{keyword}{auto} kernel = graph->param(\hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\_} + \textcolor{stringliteral}{"\_kernels"},
31           \{layerIn, \hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernelNum\_}, \hyperlink{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}{kernelHeight\_}, 
      \hyperlink{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}{kernelWidth\_}\},
32           \hyperlink{namespacemarian_1_1keywords_afdd3807e3d6fe2bc979d11fa0cf3ee3e}{keywords::init}=\hyperlink{namespacemarian_1_1inits_a8838c47537f434b855491cd3ed97ccd1}{inits::glorot\_uniform});
33       \textcolor{keyword}{auto} bias = graph->param(\hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\_} + \textcolor{stringliteral}{"\_bias"},  \{1, \hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernelNum\_}, 1, 1\},
34                                keywords::init=\hyperlink{namespacemarian_1_1inits_a1bd34fd256e3df7bb1e27955a7f2b359}{inits::zeros});
35       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_}.push\_back(kernel);
36       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_}.push\_back(bias);
37 
38       \textcolor{keyword}{auto} \hyperlink{namespacetest_a07b64f21658cf1faa97a31563ac979d2}{output} = \hyperlink{namespacemarian_a3dbe8b5eb203876cd08cf3fe75a1c6bc}{convolution}(x, kernel, bias);
39 
40       \textcolor{keywordflow}{return} \hyperlink{namespacetest_a07b64f21658cf1faa97a31563ac979d2}{output};
41     \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{d8/d2c/classmarian_1_1Convolution_ac5755a44695ec454ca80d8f309a20e80_cgraph}
\end{center}
\end{figure}


\index{marian\+::\+Convolution@{marian\+::\+Convolution}!operator()@{operator()}}
\index{operator()@{operator()}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{operator()(\+Expr x, Expr mask)}{operator()(Expr x, Expr mask)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Expr} marian\+::\+Convolution\+::operator() (
\begin{DoxyParamCaption}
\item[{{\bf Expr}}]{x, }
\item[{{\bf Expr}}]{mask}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\hypertarget{classmarian_1_1Convolution_a81e17c2e8691fb6bcb922343e797a23a}{}\label{classmarian_1_1Convolution_a81e17c2e8691fb6bcb922343e797a23a}


Definition at line 43 of file convolution.\+h.


\begin{DoxyCode}
43                                        \{
44       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_} = \{\};
45 
46       \textcolor{keyword}{auto} graph = x->graph();
47 
48       std::vector<size\_t> newIndeces;
49       \textcolor{keywordtype}{int} batchDim = x->shape()[0];
50       \textcolor{keywordtype}{int} sentenceDim = x->shape()[2];
51 
52       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} b = 0; b < batchDim; ++b) \{
53         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} t = 0; t < sentenceDim; ++t) \{
54           newIndeces.push\_back((t * batchDim) + b);
55         \}
56       \}
57 
58       \textcolor{keyword}{auto} masked = \hyperlink{namespacemarian_acd984f43188d0ae23c2a6ef13ae5293f}{reshape}(x * \hyperlink{namespacemarian_1_1keywords_a201bea6bea8108889b63081132cc3cd7}{mask},
59                             \{batchDim * sentenceDim, x->shape()[1], 1, x->shape()[3]\});
60       \textcolor{keyword}{auto} shuffled\_X = \hyperlink{namespacemarian_acd984f43188d0ae23c2a6ef13ae5293f}{reshape}(\hyperlink{namespacemarian_ace1e9a63d52edc363d70d661cf8d0257}{rows}(masked, newIndeces),
61                                      \{batchDim, 1, sentenceDim, x->shape()[1]\});
62       \textcolor{keyword}{auto} shuffled\_mask = \hyperlink{namespacemarian_acd984f43188d0ae23c2a6ef13ae5293f}{reshape}(\hyperlink{namespacemarian_ace1e9a63d52edc363d70d661cf8d0257}{rows}(mask, newIndeces),
63                                    \{batchDim, 1, sentenceDim, mask->shape()[1]\});
64 
65 
66       \hyperlink{namespacemarian_a498d8baf75b754011078b890b39c8e12}{Expr} previousInput = shuffled\_X;
67 
68       std::string kernel\_name = \hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\_} + \textcolor{stringliteral}{"kernels"};
69       \textcolor{keyword}{auto} kernel = graph->param(kernel\_name,  \{\hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernelNum\_}, 
      \hyperlink{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}{kernelHeight\_}, \hyperlink{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}{kernelWidth\_}\},
70                                   \hyperlink{namespacemarian_1_1keywords_afdd3807e3d6fe2bc979d11fa0cf3ee3e}{keywords::init}=
      \hyperlink{namespacemarian_1_1inits_a8838c47537f434b855491cd3ed97ccd1}{inits::glorot\_uniform});
71       \textcolor{keyword}{auto} bias = graph->param(\hyperlink{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{name\_} + \textcolor{stringliteral}{"\_bias"},  \{1, \hyperlink{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{kernelNum\_}, 1, 1\},
72                                  keywords::init=\hyperlink{namespacemarian_1_1inits_a1bd34fd256e3df7bb1e27955a7f2b359}{inits::zeros});
73       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_}.push\_back(kernel);
74       \hyperlink{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{params\_}.push\_back(bias);
75 
76       \textcolor{keyword}{auto} input = previousInput * shuffled\_mask;
77       previousInput = \hyperlink{namespacemarian_a3dbe8b5eb203876cd08cf3fe75a1c6bc}{convolution}(input, kernel, bias);
78 
79       \textcolor{keyword}{auto} reshapedOutput = \hyperlink{namespacemarian_acd984f43188d0ae23c2a6ef13ae5293f}{reshape}(previousInput, \{previousInput->shape()[0] * previousInput->shape
      ()[2],
80                                                     previousInput->shape()[1], 1, x->shape()[3]\});
81 
82       newIndeces.clear();
83       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} t = 0; t < sentenceDim; ++t) \{
84         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} b = 0; b < batchDim; ++b) \{
85           newIndeces.push\_back(b * previousInput->shape()[2] + t);
86         \}
87       \}
88 
89       \textcolor{keyword}{auto} reshaped = \hyperlink{namespacemarian_acd984f43188d0ae23c2a6ef13ae5293f}{reshape}(\hyperlink{namespacemarian_ace1e9a63d52edc363d70d661cf8d0257}{rows}(reshapedOutput, newIndeces),
90                          \{x->shape()[0], previousInput->shape()[1], x->shape()[2], x->shape()[3]\});
91       \textcolor{comment}{// debug(reshaped, "RESHAPED");}
92       \textcolor{keywordflow}{return} reshaped * \hyperlink{namespacemarian_1_1keywords_a201bea6bea8108889b63081132cc3cd7}{mask};
93     \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=321pt]{d8/d2c/classmarian_1_1Convolution_a81e17c2e8691fb6bcb922343e797a23a_cgraph}
\end{center}
\end{figure}




\subsection{Member Data Documentation}
\index{marian\+::\+Convolution@{marian\+::\+Convolution}!depth\+\_\+@{depth\+\_\+}}
\index{depth\+\_\+@{depth\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{depth\+\_\+}{depth_}}]{\setlength{\rightskip}{0pt plus 5cm}int marian\+::\+Convolution\+::depth\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\hypertarget{classmarian_1_1Convolution_a10d9391dababa5ca35ada157ba4974ee}{}\label{classmarian_1_1Convolution_a10d9391dababa5ca35ada157ba4974ee}


Definition at line 100 of file convolution.\+h.

\index{marian\+::\+Convolution@{marian\+::\+Convolution}!kernel\+Height\+\_\+@{kernel\+Height\+\_\+}}
\index{kernel\+Height\+\_\+@{kernel\+Height\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{kernel\+Height\+\_\+}{kernelHeight_}}]{\setlength{\rightskip}{0pt plus 5cm}int marian\+::\+Convolution\+::kernel\+Height\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\hypertarget{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}{}\label{classmarian_1_1Convolution_aa2e7a504274fbe1bd24fce5fe89d6ff7}


Definition at line 101 of file convolution.\+h.

\index{marian\+::\+Convolution@{marian\+::\+Convolution}!kernel\+Num\+\_\+@{kernel\+Num\+\_\+}}
\index{kernel\+Num\+\_\+@{kernel\+Num\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{kernel\+Num\+\_\+}{kernelNum_}}]{\setlength{\rightskip}{0pt plus 5cm}int marian\+::\+Convolution\+::kernel\+Num\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\hypertarget{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}{}\label{classmarian_1_1Convolution_aaf7c9a32c5b843d261548abcedd2f25d}


Definition at line 103 of file convolution.\+h.

\index{marian\+::\+Convolution@{marian\+::\+Convolution}!kernel\+Width\+\_\+@{kernel\+Width\+\_\+}}
\index{kernel\+Width\+\_\+@{kernel\+Width\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{kernel\+Width\+\_\+}{kernelWidth_}}]{\setlength{\rightskip}{0pt plus 5cm}int marian\+::\+Convolution\+::kernel\+Width\+\_\+\hspace{0.3cm}{\ttfamily [protected]}}\hypertarget{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}{}\label{classmarian_1_1Convolution_a4b65ffe7fe84099465ecf6e0e402f4aa}


Definition at line 102 of file convolution.\+h.

\index{marian\+::\+Convolution@{marian\+::\+Convolution}!name\+\_\+@{name\+\_\+}}
\index{name\+\_\+@{name\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{name\+\_\+}{name_}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::string marian\+::\+Convolution\+::name\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}{}\label{classmarian_1_1Convolution_adf629c3e64cd0bd05a742543144512d5}


Definition at line 97 of file convolution.\+h.

\index{marian\+::\+Convolution@{marian\+::\+Convolution}!params\+\_\+@{params\+\_\+}}
\index{params\+\_\+@{params\+\_\+}!marian\+::\+Convolution@{marian\+::\+Convolution}}
\subsubsection[{\texorpdfstring{params\+\_\+}{params_}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::vector$<${\bf Expr}$>$ marian\+::\+Convolution\+::params\+\_\+\hspace{0.3cm}{\ttfamily [private]}}\hypertarget{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}{}\label{classmarian_1_1Convolution_a6a56e7a677386b591a1622732f53ae9a}


Definition at line 96 of file convolution.\+h.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{convolution_8h}{convolution.\+h}\end{DoxyCompactItemize}
